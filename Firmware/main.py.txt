import board
import busio
from kmk.kmk_keyboard import KMKKeyboard
from kmk.scanners.keypad import KeysScanner
from kmk.keys import KC
from kmk.modules.macros import Macros
from kmk.extensions.RGB import RGB
from kmk.modules.encoder import Encoder
from kmk.extensions.display import Display, SSD1306

# Inicializace klávesnice
keyboard = KMKKeyboard()
macros = Macros()
keyboard.modules.append(macros)

# 1. TLAČÍTKA (Piny 8, 9, 10, 11)
# Odpovídá zapojení SW1-SW4 ve schématu
PINS = [board.D8, board.D9, board.D10, board.D11]
keyboard.matrix = KeysScanner(
    pins=PINS,
    value_when_pressed=False,
)

# 2. RGB LED (Pin 5)
# Nastaveno pro 4 SK6812MINI-E diody
rgb = RGB(pixel_pin=board.D5, num_pixels=4)
keyboard.extensions.append(rgb)

# 3. ENKODÉR (A=D1, B=D2, Button=D3)
# Nastaveno pro otáčení (D1, D2) i klikání (D3)
encoder = Encoder()
keyboard.modules.append(encoder)
encoder.pins = ((board.D1, board.D2, board.D3, False),) 

# 4. OLED DISPLEJ (SCL=D6, SDA=D4)
# Používáme piny pro I2C komunikaci, aby nebyla kolize s LED
i2c_bus = busio.I2C(board.D6, board.D4) 

display_driver = SSD1306(
    i2c=i2c_bus,
    device_address=0x3C,
)

display = Display(display_driver)
keyboard.extensions.append(display)

# DEFINICE KLÁVES (Zatím písmena A, B, C, D)
keyboard.keymap = [
    [KC.A, KC.B, KC.C, KC.D]
]

if __name__ == '__main__':

    keyboard.go()
